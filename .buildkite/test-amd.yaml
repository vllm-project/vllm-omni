steps:

- label: "Diffusion Model Test"
  timeout_in_minutes: 15
  agent_pool: mi325_2
  depends_on: amd-build
  mirror_hardwares: [amdexperimental, amdproduction, amdtentative]
  grade: Blocking
  source_file_dependencies:
  - ./
  commands:
    - export GPU_ARCHS=gfx942
    - export MIOPEN_FIND_MODE=FAST
    - export VLLM_ROCM_USE_AITER=1
    - export VLLM_ROCM_USE_AITER_MHA=1
    - export VLLM_ROCM_USE_AITER_LINEAR=0
    - export VLLM_ROCM_USE_AITER_RMSNORM=0
    - pytest -s -v tests/e2e/offline_inference/test_t2i_model.py

- label: "Diffusion Cache Backend Test"
  timeout_in_minutes: 15
  agent_pool: mi325_1
  depends_on: amd-build
  mirror_hardwares: [amdexperimental, amdproduction, amdtentative]
  source_file_dependencies:
  - ./
  commands:
    - export GPU_ARCHS=gfx942
    - export VLLM_LOGGING_LEVEL=DEBUG
    - export VLLM_WORKER_MULTIPROC_METHOD=spawn
    - export MIOPEN_FIND_MODE=FAST
    - export VLLM_ROCM_USE_AITER=1
    - export VLLM_ROCM_USE_AITER_MHA=1
    - export VLLM_ROCM_USE_AITER_LINEAR=0
    - export VLLM_ROCM_USE_AITER_RMSNORM=0
    - pytest -s -v tests/e2e/offline_inference/test_cache_dit.py tests/e2e/offline_inference/test_teacache.py

- label: "Omni Model Test Qwen2-5-Omni"
  timeout_in_minutes: 15
  agent_pool: mi325_2
  depends_on: amd-build
  mirror_hardwares: [amdexperimental, amdproduction, amdtentative]
  source_file_dependencies:
  - ./
  commands:
    - export GPU_ARCHS=gfx942
    - export VLLM_LOGGING_LEVEL=DEBUG
    - export VLLM_WORKER_MULTIPROC_METHOD=spawn
    - export MIOPEN_FIND_MODE=FAST
    - export VLLM_ROCM_USE_AITER=1
    - export VLLM_ROCM_USE_AITER_MHA=1
    - export VLLM_ROCM_USE_AITER_LINEAR=0
    - export VLLM_ROCM_USE_AITER_RMSNORM=0
    - pytest -s -v tests/e2e/offline_inference/test_qwen2_5_omni.py

- label: "Omni Model Test Qwen3-Omni"
  timeout_in_minutes: 15
  agent_pool: mi325_2
  depends_on: amd-build
  mirror_hardwares: [amdexperimental, amdproduction, amdtentative]
  source_file_dependencies:
  - ./
  commands:
    - export GPU_ARCHS=gfx942
    - export VLLM_LOGGING_LEVEL=DEBUG
    - export VLLM_WORKER_MULTIPROC_METHOD=spawn
    - export MIOPEN_FIND_MODE=FAST
    - export VLLM_ROCM_USE_AITER=1
    - export VLLM_ROCM_USE_AITER_MHA=1
    - export VLLM_ROCM_USE_AITER_LINEAR=0
    - export VLLM_ROCM_USE_AITER_RMSNORM=0
    - pytest -s -v tests/e2e/offline_inference/test_qwen3_omni.py tests/e2e/online_serving/test_qwen3_omni.py
