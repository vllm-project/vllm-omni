# Single-stage (AR only) stage config for MammothModa2.
# 用于通过 `vllm_omni.Omni` / `OmniLLM` 路径启动单个 AR 引擎并直接产出文本。
stage_args:
  - stage_id: 0
    runtime:
      devices: "0"
      max_batch_size: 1
    engine_args:
      model_stage: ar
      # HF 配置里的 architectures=["Mammothmoda2Model"]，且已在 OmniModelRegistry 注册
      model_arch: Mammothmoda2Model
      worker_cls: vllm_omni.worker.gpu_ar_worker.GPUARWorker
      scheduler_cls: vllm_omni.core.sched.omni_ar_scheduler.OmniARScheduler
      enforce_eager: true
      trust_remote_code: true
      # 单阶段直接产出文本，无需输出 latent/pooler
      engine_output_type: text
      enable_prefix_caching: false
      gpu_memory_utilization: 0.3
    is_comprehension: true
    final_output: true
    final_output_type: text
    default_sampling_params:
      temperature: 0.0
      top_p: 1.0
      top_k: -1
      max_tokens: 256
      detokenize: True
